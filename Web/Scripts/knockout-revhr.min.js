(function(){var a=[{name:"Alabama",abbr:"AL"},{name:"Alaska",abbr:"AK"},{name:"American Samoa",abbr:"AS"},{name:"Arizona",abbr:"AZ"},{name:"Arkansas",abbr:"AR"},{name:"California",abbr:"CA"},{name:"Colorado",abbr:"CO"},{name:"Connecticut",abbr:"CT"},{name:"Delaware",abbr:"DE"},{name:"District Of Columbia",abbr:"DC"},{name:"Federated States Of Micronesia",abbr:"FM"},{name:"Florida",abbr:"FL"},{name:"Georgia",abbr:"GA"},{name:"Guam",abbr:"GU"},{name:"Hawaii",abbr:"HI"},{name:"Idaho",abbr:"ID"},{name:"Illinois",abbr:"IL"},{name:"Indiana",abbr:"IN"},{name:"Iowa",abbr:"IA"},{name:"Kansas",abbr:"KS"},{name:"Kentucky",abbr:"KY"},{name:"Louisiana",abbr:"LA"},{name:"Maine",abbr:"ME"},{name:"Marshall Islands",abbr:"MH"},{name:"Maryland",abbr:"MD"},{name:"Massachusetts",abbr:"MA"},{name:"Michigan",abbr:"MI"},{name:"Minnesota",abbr:"MN"},{name:"Mississippi",abbr:"MS"},{name:"Missouri",abbr:"MO"},{name:"Montana",abbr:"MT"},{name:"Nebraska",abbr:"NE"},{name:"Nevada",abbr:"NV"},{name:"New Hampshire",abbr:"NH"},{name:"New Jersey",abbr:"NJ"},{name:"New Mexico",abbr:"NM"},{name:"New York",abbr:"NY"},{name:"North Carolina",abbr:"NC"},{name:"North Dakota",abbr:"ND"},{name:"Northern Mariana Islands",abbr:"MP"},{name:"Ohio",abbr:"OH"},{name:"Oklahoma",abbr:"OK"},{name:"Oregon",abbr:"OR"},{name:"Palau",abbr:"PW"},{name:"Pennsylvania",abbr:"PA"},{name:"Puerto Rico",abbr:"PR"},{name:"Rhode Island",abbr:"RI"},{name:"South Carolina",abbr:"SC"},{name:"South Dakota",abbr:"SD"},{name:"Tennessee",abbr:"TN"},{name:"Texas",abbr:"TX"},{name:"Utah",abbr:"UT"},{name:"Vermont",abbr:"VT"},{name:"Virgin Islands",abbr:"VI"},{name:"Virginia",abbr:"VA"},{name:"Washington",abbr:"WA"},{name:"West Virginia",abbr:"WV"},{name:"Wisconsin",abbr:"WI"},{name:"Wyoming",abbr:"WY"}];toastr.options={closeButton:!1,debug:!1,positionClass:"toast-top-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},ko.validation.init({errorMessageClass:"help-block",errorElementClass:"has-error"}),ko.bindingHandlers.radioName={init:function(a,b,c,d,e){},update:function(a,b,c,d,e){var f=b(),g="";ko.isObservable(f)&&f._fieldName?g=f._fieldName:g=ko.unwrap(f),e.$index!==undefined&&(g=g+"_"+e.$index()),$(a).attr("name")!=g&&$(a).attr("name",g)}},ko.observableArray.fn.addNewItem=function(){var a=this._itemType,b=new a;this.push(b)},ko.modelToJS=function(a,b){var c=_.values(a),d={fields:[]};return _.each(c,function(a){if(!ko.isObservable(a)||!a._fieldName)return;var b=a();if(a._fieldType=="array")_.each(b,function(b){var c=ko.modelToJS(b);b._destroy&&c.fields.push({name:"_destroy",value:!0}),d.repeatedFields||(d.repeatedFields=[]),d.repeatedFields.push({name:a._fieldName,fields:c.fields})});else{if(b===undefined||b===null)b="";d.fields.push({name:a._fieldName,value:b})}}),d},ko.jsToModel=function(a,b){var c=_.values(b),d=_.object(_.pluck(a.fields,"name"),_.pluck(a.fields,"value"));_.each(c,function(b){if(!ko.isObservable(b)||!b._fieldName)return;if(b._fieldType=="array"){var c=_.where(a.repeatedFields||[],{name:b._fieldName});_.each(c,function(a){if(a==null)return;var c=new b._itemType;b.push(c),ko.jsToModel(a,c)});var e=b.minLength||1;while(b().length<e)b.addNewItem()}else if(b._fieldType=="check")b(d[b._fieldName]=="true");else{var f=d[b._fieldName];f!==undefined&&f!=null?b(f):b("")}})},ko.validation.rules.formattedNumber={validator:function(a,b){return b?ko.validation.utils.isEmptyVal(a)?!0:(a=(""+a).replace(/[\$,%]/g,""),isNaN(a)==0):!0},message:"Please enter a number"},ko.validation.registerExtenders(),ko.extenders.field=function(a,b){var c=b.name,d=b.type,e=a;if(d==="number"||d=="currency"||d=="percent"){var f=d=="number"?"0,0":d=="currency"?"$0,0":"0.00%";e=ko.computed({read:a,write:function(b){var c=(""+b).replace(/[\$,%]/g,"");if(isNaN(c)){a(b);return}c.length&&(d=="percent"&&(c/=100),c=numeral(parseFloat(+c)).format(f));var e=a();c!==e?a(c):b!==e&&a.notifySubscribers(c)}}).extend({notify:"always"})}return e._fieldName=c,e._fieldType=d,e(a()),e},ko.idField=function(a){return ko.observable(a).extend({field:{name:"id",type:"id"}})},ko.textField=function(a,b){return ko.observable(b).extend({field:{name:a,type:"text"}})},ko.numberField=function(a,b){return ko.observable(b).extend({field:{name:a,type:"number"}}).extend({formattedNumber:!0})},ko.currencyField=function(a,b){return ko.observable(b).extend({field:{name:a,type:"currency"}}).extend({formattedNumber:!0})},ko.percentField=function(a,b){return ko.observable(b).extend({field:{name:a,type:"percent"}}).extend({formattedNumber:!0})},ko.radioField=function(a,b){return ko.observable(b).extend({field:{name:a,type:"radio"}})},ko.checkField=function(a,b){return ko.observable(b).extend({field:{name:a,type:"check"}})},ko.arrayField=function(a,b){var c=ko.observableArray();return c._fieldName=a,c._fieldType="array",c._itemType=b,c.removeItem=function(a){c.remove(a),c().length==0&&setTimeout(function(){c.addNewItem()},0)},c},ko.dirtyFlag=function(a){var b=ko.observable(!1);return _.each(a,function(a,c){if(!ko.isObservable(a)||!a._fieldName)return;a.subscribe(function(){b(!0)})}),b.reset=function(){b(!1)},b},ko.bindingHandlers.arrayField={init:function(a,b,c,d,e){var f=b();ko.applyBindingsToNode(a,{foreach:f},e);var g=!1;return $(a).on("focus","input,select,textarea",function(){var a=ko.contextFor(this);return g||a.$index()!=f().length-1?!0:(g=!0,setTimeout(function(){f.addNewItem(),g=!1},0),!0)}),{controlsDescendantBindings:!0}},update:function(a,b,c){}},ko.bindingHandlers.fadeVisible={init:function(a,b){var c=b();$(a).toggle(ko.unwrap(c))},update:function(a,b){var c=b();ko.unwrap(c)?$(a).fadeIn():$(a).fadeOut()}},ko.bindingHandlers.selectState={init:function(b,c,d,e,f){var g=c();return ko.applyBindingsToNode(b,{options:a,value:g,optionsText:"name",optionsValue:"abbr"},f),$(b).select2({width:"resolve"}),g.subscribe(function(){$(b).trigger("change")}),ko.utils.domNodeDisposal.addDisposeCallback(b,function(){$(b).select2("destroy")}),{controlsDescendantBindings:!0}}},ko.bindingHandlers.selectjob={init:function(a,b,c,d,e){var f=b(),g={};ko.utils.arrayForEach(ko.__survey_jobs,function(a){g[a.id]=a.description}),ko.applyBindingsToNode(a,{options:ko.__survey_jobs,value:f,optionsText:function(a){return a.id+" "+a.text},optionsValue:"id",optionsAfterRender:function(a,b){$(a).attr("data-description",b.description)}},e),$(a).select2({width:"resolve"}),f.subscribe(function(){$(a).trigger("change")}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).select2("destroy")});var h=$(a).closest(".job-desc-popover");return h.length&&(h.popover({container:"body",placement:"auto right",trigger:"manual",animation:!1}),$(a).on("select2-highlight",function(a){h.data("bs.popover").options.content=g[a.val],h.popover("show")}),$(a).on("select2-close",function(){h.popover("hide")})),{controlsDescendantBindings:!0}}},ko.bindingHandlers.selectSummary={init:function(a,b,c,d,e){var f=e.$data,g=function(a,b){return a+" "+b+(a==1?"":"s")},h=[],i=function(){h=ko.utils.arrayMap(f.level1Items(),function(a){return{text:a.name(),searchText1:"",searchText2:"",formattedText:'<div class="select-summary-level1">'+a.name()+"<span> ("+g(a.children().length," job title")+", "+g(a.itemCount()," incumbent")+")</span></div>",children:ko.utils.arrayMap(a.children(),function(b){return{text:b.name(),searchText1:a.name().toUpperCase(),searchText2:"",formattedText:'<div class="select-summary-level2">'+b.name()+"<span> ("+g(b.itemCount()," incumbent")+")</span></div>",children:ko.utils.arrayMap(b.children()||[],function(c){return{id:c.id,text:c.name(),searchText1:a.name().toUpperCase(),searchText2:b.name().toUpperCase(),formattedText:'<div class="select-summary-level3"><i class="fa fa-user"></i> '+c.name()+"</div>"}})}})}})};return i(),f.changed.subscribe(function(){i()}),$(a).select2({width:"resolve",allowClear:!0,data:function(){return{results:h}},formatSelection:function(a){return a.text},formatResult:function(a){return a.formattedText},matcher:function(a,b,c){return a=a.toUpperCase(),b.toUpperCase().indexOf(a)>=0||c.searchText1.indexOf(a)>=0||c.searchText2.indexOf(a)>=0}}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).select2("destroy")}),f.selectedLevel3.subscribe(function(b){$(a).select2("val",b?b.id:null)}),$(a).on("change",function(a){f.selectItemById(a.val)}),$(a).select2("val",f.getSelectedItemId()),{controlsDescendantBindings:!0}}};var b=function(a){var b=function(a,b,c){var d=this;d.name=ko.observable(a),d.parent=b,d.id=c,d.children=ko.observableArray(),d.itemCount=ko.observable(0)},c=this;c.level1Items=ko.observableArray(),c.selectedLevel1=ko.observable(),c.selectedLevel2=ko.observable(),c.selectedLevel3=ko.observable(),c.filter=ko.observable(),c.changed=ko.observable().extend({notify:"always"}),c.totalItemCount=ko.computed(function(){var a=0;return ko.utils.arrayForEach(c.level1Items(),function(b){a+=b.itemCount()}),a}),c.currentItems=ko.computed(function(){var a=null;return c.selectedLevel2()?a=c.selectedLevel2().children():c.selectedLevel1()?a=c.selectedLevel1().children():a=c.level1Items(),c.filter()?ko.utils.arrayFilter(a,function(a){return a.name().toLowerCase().indexOf(c.filter().toLowerCase())!=-1}):a}),c.currentLevel=ko.computed(function(){return c.selectedLevel2()?"level2":c.selectedLevel1()?"level1":"level0"}),c.id2Item={},c.addItem=function(a,d){if(!a)return;var e=c.id2Item[a.id];e&&c.removeItemById(a.id,!0);var f=ko.utils.arrayFirst(c.level1Items(),function(b){return b.name()==a.level1});f==null&&c.level1Items.push(f=new b(a.level1)),f.itemCount(f.itemCount()+1);var g=ko.utils.arrayFirst(f.children(),function(b){return b.name()==a.level2});g==null&&f.children.push(g=new b(a.level2,f)),g.itemCount(g.itemCount()+1),a=new b(a.level3,g,a.id),g.children.push(a),c.id2Item[a.id]=a,d||c.changed(!0)},c.removeItemById=function(a,b){var d=c.id2Item[a];if(!d)return;delete c.id2Item[a];var e=d.parent,f=e.parent;e.itemCount(e.itemCount()-1),f.itemCount(f.itemCount()-1),e.children.remove(d),e.children().length==0&&e.parent.children.remove(e),b||c.changed(!0)},c.selectItemById=function(a){var b=c.id2Item[a];if(!b){c.selectedLevel3(null);return}var d=b.parent,e=d.parent;c.selectedLevel1()!=e&&c.selectedLevel1(e),c.selectedLevel2()!=d&&c.selectedLevel2(d),c.selectedLevel3(b)},c.getSelectedItemId=function(){return c.selectedLevel3()?c.selectedLevel3().id:null},a&&ko.utils.arrayForEach(a,function(a){c.addItem(a,!0)})},c=function(a,b,c,d){var e=this;e.formUrl=b,e.model=ko.validatedObservable(new a),e.summary=new ko.revhr.SummaryModel(d),e.isDirty=ko.dirtyFlag(e.model()),e.successMessage=ko.observable("").extend({notify:"always"}),e.errorMessage=ko.observable("").extend({notify:"always"}),e.ajaxProgress=ko.observable("").extend({notify:"always"}),e.successMessage.subscribe(function(a){a&&toastr.success(a)}),e.errorMessage.subscribe(function(a){a&&toastr.error(a)}),e.clearErrors=function(){e.model.errors.showAllMessages(!1)},e.load=function(a,b){ko.jsToModel(a,e.model()),e.clearErrors(),e.isDirty.reset()},e.load(c,!0),e.model().id()&&e.summary.selectItemById(e.model().id()),e.summary.selectedLevel3.subscribe(function(){var a=e.summary.selectedLevel3();a&&a.id?a.id!=e.model().id()&&e.loadById(a.id):e.model().id()&&e.load({})}),e.loadById=function(a){var b=e.formUrl+"/"+a;return e.clearMessages(),$(".survey-form").fadeTo(400,.3),e.ajaxProgress("Loading..."),$.ajax({type:"GET",url:b,contentType:"application/json; charset=utf-8",dataType:"json",statusCode:{401:function(){window.location.reload(!0)}}}).done(function(a){e.load(a)}).fail(function(){e.errorMessage("Unable to load data, please try again")}).always(function(){e.ajaxProgress(""),$(".survey-form").fadeTo(300,1)})},e.save=function(){var a=e.model().isValid();if(a!==undefined&&!a){e.model.errors.showAllMessages(!0),e.errorMessage("You have one or more errors in the form");return}e.clearMessages(),$(".survey-form").fadeTo(400,.3),e.ajaxProgress("Saving...");var b=e.formUrl;e.model().id()&&(b=b+"/"+e.model().id());var c=ko.modelToJS(e.model());return $.ajax({type:"POST",url:b,data:JSON.stringify(c),contentType:"application/json; charset=utf-8",dataType:"json",statusCode:{401:function(){window.location.reload(!0)}}}).done(function(a){a.breadcrumb&&e.summary.addItem(a.breadcrumb),e.model().id(a.id),e.isDirty.reset(),a.breadcrumb&&e.summary.selectItemById(a.id),e.successMessage("Data saved")}).fail(function(){e.errorMessage("An error occurred while saving data, please try again")}).always(function(){e.ajaxProgress(""),$(".survey-form").fadeTo(300,1)})},e.copy=function(){$(".survey-form").fadeTo(400,.3,function(){e.model().id(""),e.model().employee_id&&e.model().employee_id(""),e.model().job_title&&e.model().job_title(""),e.clearMessages(),e.clearErrors(),e.isDirty.reset(),e.summary.selectedLevel3(null),$(".survey-form").fadeTo(300,1)})},e.clear=function(){e.load({id:e.model().id()},!0)},e.cancel=function(){e.model().id()&&e.loadById(e.model().id())},e.clearMessages=function(){e.errorMessage(""),e.successMessage(""),toastr.clear()}};ko.revhr=ko.revhr||{},ko.revhr.SummaryModel=b,ko.revhr.FormModel=c})()